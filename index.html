<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>feed the hungry bear~</title>
  <link rel="stylesheet" href="style.css">

  <!-- import libraries -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
</head>

<body>

  <div id="playground"></div>
  <div class="item food"></div>
  <div class="item water"></div>
  <div class="item toy"></div>
  <div class="text">feed the hungry bear</div>
  
<script>

  let gif, detector, video

  async function addVideo() {
    const video = document.createElement('video')
    video.setAttribute('autoplay', '')
    video.setAttribute('muted', '')
    video.setAttribute('playsinline', '')
    document.body.appendChild(video)
    const stream = await navigator.mediaDevices.getUserMedia({video: true})
    video.srcObject = stream    
    return video
  }
  
  async function setupModel () {
    const model = poseDetection.SupportedModels.BlazePose
    const detectorConfig = {
      runtime: 'mediapipe',
      solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/pose'
    }
    const detector = await poseDetection.createDetector(model, detectorConfig)
    return detector
  }
  
  async function draw () {
		const poses = await detector.estimatePoses(video)
    if (poses.length > 0) { 
    	const nose = poses[0].keypoints[0]
      console.log(nose) 
    	gif.style.left = nose.x * 1.2 + 'px'
      gif.style.top = nose.y * 2 + 'px'
    }
    requestAnimationFrame(draw)
  }

  async function setup () {
    gif = document.createElement('img')
    gif.src = 'bear.gif'
    gif.style.position = 'absolute'
    gif.style.width = '70px'
    document.body.appendChild(gif)
    
    video = await addVideo()
  	detector = await setupModel()
    console.log('detector ready', detector)
  
    setTimeout(draw, 1000)  // this is a hack!
    // ...to get around the "race conditions" issue
  }
  
  window.addEventListener('load', setup)





  //game portion
  //QUESTION: IS IT POSSIBLE TO CREATE A GIF-OVER INSTEAD OF MOUSE-OVER?

  // function changeColor (e) {e.target.style.backgroundColor = 'white'}
  // function changeBack (e) {e.target.style.backgroundColor = 'black'}
  
  // function setup2 () {
  //   const items = document.querySelectorAll('.item')
  //   for (let i = 0; i < boxes.length; i++) {
  //     items[i].addEventListener('mouseover', changeColor)
  //     items[i].addEventListener('mouseout', changeBack)
  //   }
  // }
  
  // window.addEventListener('load', setup2)





  //checking for overlap 
  //img.style.left & top are constantly changing
  //


  const food = document.querySelector('.food')
  const foodRect = food.getBoundingClientRect();

  console.log(foodRect)


  // const overlap = !(gifRect.right < divRect.left || 
  //                   gifRect.left > divRect.right || 
  //                   gifRect.bottom < divRect.top || 
  //                   gifRect.top > divRect.bottom);

  // if (overlap) {
  //   food.style.backgroundColor = 'white'
  // } else {
  //   food.style.backgroundColor = 'red'
  // }

</script>

</body>
</html>